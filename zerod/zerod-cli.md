<!-- @routePath:/zerod-cli -->

# Zerod-cli

`zerod-cli`是快速初始化一个基于`react`、`scss`或`less`的脚手架工具，可选多种创建模板。

## 安装

```shell
# 更改registry(已改过可以跳过)
npm config set registry http://172.16.8.10:8081/repository/npm-all
# 安装
npm install zerod-cli -g
```

## 初始化项目

```shell
zerod init projectName

? 项目描述: (zerod-webpack project)
? 创建者: (默认git用户+邮箱)
? 模板: (Use arrow keys)
> zerod-admin-webpack
  zerod-simple-webpack
  zerod-mobile-webpack
  zerod-markdown-webpack
? gitlab连接方式: (Use arrow keys)
> http
  ssh
? 默认启用ESlint: (Y/n)
```

## 模板的通用命令

> `npm run dll` 默认将 react、react-dom、react-router-dom 预打包生成 dllStatic/reactDll, 并且将"dependencies"的依赖包预打包生成 dllStatic/vendorDll。

> `npm run dll-lib` 当 npm run dev 一次之后会生成当前依赖 antd 的模块清单 dllLibrarysManifes/antd-modules-manifes.json，npm run dll-lib 会根据此 json 预打包 antd 生成 dllStatic/librarysDll；cnpm install 与 npm install 安装的依赖包的模块路径有所不同，建议弃用 cnpm。

> `npm run dev` 本地启用开发服务。

> `npm run build` 生产时构建打包，后接`--report`参数，打包完成后会启动模块依赖报告。

> `npm run eslint` 用 eslint 检查`src`下的 js、jsx 代码规范，前提先要全局安装 `npm install eslint eslint-plugin-react eslint-plugin-react-hooks -g`一次。

> 当需要删除`node_modules`时，推荐使用`rimraf`，`npm install rimraf -g`后`rimraf node_modules`。

`npm run dev`和`npm run build` 后台接的 `--` 参数都会打入到环境变量。

```js
npm run build --basepath=/myPath/
```

在浏览器端通过`process.env`取得。

```js
const basepath = process.env.basepath; // "/myPath/"
```

## 配置文件

每个模板都需要配置文件`zerod.config.js`，主要的配置属性：

<!-- prettier-ignore-start -->
<!-- SOMETHING AUTO-GENERATED BY TOOLS - START -->

| 属性   | 说明      | 类型      | 默认值|
| ------ |-----------| ---------| ------------ |
| webpackMerger | 追加合并 webpack 的配置，如添加入口配置等等。[webpack 文档](https://webpack.js.org/)| object | -- |
| loaders | 追加加载器(同 webpackMerger.module.rules) | array  | -- |
| platform | "pc"对应 zerod-admin-webpack 模板,"mobile"对应 zerod-mobile-webpack 模板,"simple"对应 zerod-simple-webpack 模板 | "pc"\|"mobile"\|"simple" | --|
| pace | 是否启用页面顶部进度条  | boolean  | true |
| ant-icons  | 是否 antd v3 的图标按需引入,当 platform==="pc"有效,必需 src/ant-icons.js | boolean | true |
| copyFolderName | 共享代码包的目录名称 (允许在当前项目维护一个发布到私服的公共代码包) | string| "share-code" |
| babel-includes | 追加 babel 编译包含的目录，默认包含了 src、share 或 zerod 开头的目录| array | [] |
| favicon | 浏览器标签页小图标| string| -- |
| scssVars| scss 变量覆盖 less 变量,目前主要用于 scss 变量覆盖 antd 的 less 的主题变量 (v1.5.0 后不再有 scss 变量提升的效果)| string| -- |
| scssRule| 追加 sass-loader 的规则配置,false 则不使用 sass-loader。[sass-loader rules](https://webpack.js.org/loaders/sass-loader/) | object \|function(opt){return opt} | -- |
| lessRule| 追加 less-loader 的规则配置,false 则不使用 less-loader 。[less-loader rules](https://webpack.js.org/loaders/less-loader/)| object \|function(opt){return opt} | -- |
| reactCssModulesOptions | [babel-plugin-react-css-modules 插件的属性配置](https://github.com/gajus/babel-plugin-react-css-modules#options) 。| object| -- |
| urlLoaderOptions| [url-loader 的属性配置](https://webpack.js.org/loaders/url-loader/#options)。  | object| -- |
| dll  | 预打包的配置，npm run dll \| \| dll-lib 触发  | object| -- |
| dll.disabled| 是否禁用 dll  | boolean| false |
| dll.include| 除了 package.json 的 dependencies 记录的包，还需包含  | array | [] |
| dll.exclude| 从 package.json 的 dependencies 记录的包中不包含  | array | [] |
| dll.distEnv| 是否分模式打包(会分别以'production'和'development'模式，false 只以'production'模式打包)  | boolean| true  |
| dll.usefulEnvName  | 引入 dll 资源时使用的模式，默认取自 process.env.NODE_ENV  | 'production' \| 'development'| -- |
| dll.dllModules | 需要预打包的模块(每组模块是按顺序依赖的，例如'react'组生成 reactDll 后，'vendor'组依赖'react'组生成 vendorDll)，默认：[{name:'react',modules: ['react', 'react-dom', 'react-router-dom']},{name:'vendor',modules: package.dependencies}] | array[object] | -- |
| dll.dllLibrarys| 按需预打包的组件库(即生成 dllLibrarysManifes 清单文件的配置) ，默认：[{libraryName: 'antd',styleDirectory: 'style',moduleFilter: null,}]| array[object] | -- |
| dll.dllLibrarys[].libraryName| 组件库包名称  | string| -- |
| dll.dllLibrarys[].styleDirectory | 组件库按需样式模块的目录名称，组件库的模块目录结构应该与 antd 的目录结构相似才能按需打包样式 | string| -- |
| dll.dllLibrarys[].moduleFilter| 过滤模块的方法| function(moduleString){return boolean}| -- |
| CopyWebpackOptions | 追加 [copy-webpack-plugin 插件的配置](https://github.com/webpack-contrib/copy-webpack-plugin/tree/v5.1.1)。| array[object] \|(config,NODE_ENV)=>([{}]) | [] |
| HtmlIncludeAssets  | 追加 [html-webpack-tags-plugin 插件的配置](https://github.com/jharris4/html-webpack-tags-plugin#options)。 | array[object]\|(config,NODE_ENV)=>([{}])  | [] |
| dev  | 开发模式的独立配置| {}| -- |
| dev.assetsSubDirectory | 不进行编译的静态文件目录 | string| "static" |
| dev.assetsPublicPath| 绝对路径前缀， 也可以来自 npm run dev --baserouter=/mypath/ \|\| --basepath=/mypath/， 优先级：baserouter>basepath>assetsPublicPath  | string| "/"|
| dev.proxyTable | webpack-dev-server 的反代理配置 | object\|array | {} |
| dev.autoOpenBrowser| 启动服务后是否自动打开浏览器,可以是浏览器文件如 'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe' | boolean\|string  | false |
| dev.errorOverlay| 出现编译器错误或警告时，在浏览器中显示全屏覆盖| boolean| true  |
| dev.notifyOnErrors | 译出错在系统右下角弹出提醒  | boolean| true  |
| dev.useEslint  | 是否编译时启用 eslint-loader| boolean| true  |
| dev.eslintRule | 追 eslint-loader 的规则配置 | object| {} |
| dev.cssSourceMap| 是否编译后的 css 生成 sourceMap | boolean| true  |
| build| 生产模式独立配置  | object| -- |
| build.index| 根目录的 index.html 模板打包后的位置| string| -- |
| build.assetsRoot| 打包后所有文件的位置  | string| -- |
| build.assetsSubDirectory  | 不进行编译的静态文件目录 | string| -- |
| build.assetsPublicPath | 绝对路径前缀, 也可以来自 npm run build --baserouter=/mypath/ \|\| --basepath=/mypath/， 优先级： baserouter>basepath>assetsPublicPath| string| "/"|
| build.productionSourceMap | 是否编译后的 css、js 生成 sourceMap | boolean| false |
| build.productionGzip| 是否编译后压缩 zip| boolean| false |
| build.productionGzipExtensions| 压缩 zip 的包含文件类型  | array | ["js","css"] |
| webpackReplacement | 覆盖 webpack 的配置| {}| -- |

<!-- SOMETHING AUTO-GENERATED BY TOOLS - END -->
<!-- prettier-ignore-end -->

```js
/**
 * @renderMode:inline
 * @componentName:EmptyRender
 * @description:一些属性使用示例，请展开查看
 */
const path = require('path');
function resolve(dir) {
    return path.join(__dirname, './', dir);
}
const config = {
    //追加合并webpack配置
    webpackMerger: {
        //入口
        entry: { app: [resolve('src/main.js')] },
        //追加加载器
        module: { rules: [] },
    },
    //增加加载器
    loaders: [
        { test: /\.xml$/, loader: 'xml-loader' },
        {
            test: /\.bpmn$/,
            use: 'raw-loader',
        },
    ],
    platform: 'pc', //"pc" 对应 zerod-admin-webpack 模板,"mobile" 对应 zerod-mobile-webpack 模板
    //是否添加 pace.js(页面顶部进度条)
    pace: true,
    //是否antd的图标按需引入,在src/ant-icons.js
    'ant-icons': true,
    //根目录的哪个目录copy到node_modules,copy到node_modules的包名称是 copyFolderName/package.json的name，由npm run copy触发
    copyFolderName: 'share-code',
    //babel-loader 要包含的文件夹是哪些默认包含src,false则不使用babel-loader
    'babel-includes': [],
    //浏览器标签页小图标
    favicon: resolve('src/assets/images/logo.png'),
    //scss变量覆盖less变量,目前主要用于scss变量覆盖antd的less的主题变量
    scssVars: [resolve('node_modules/zerod/ant-theme-vars.scss')],
    //追加sass-loader的rule,false则不使用sass-loader
    scssRule: {},
    //追加less-loader的rule,false则不使用less-loader
    lessRule: {},
    //babel-plugin-react-css-modules的配置
    reactCssModulesOptions: {},
    //url-loader的参数配置
    urlLoaderOptions: {},
    //将package.json的dependencies的依赖包预打包,npm run dll||dll-dev||dll-prod 触发
    dll: {
        //是否禁用dll
        disabled: false,
        //除了package.json的dependencies，还需包含
        include: [],
        //打包dll时从package.json的dependencies中不包含
        exclude: ['react-redux', 'redux'],
    },
    //copy-webpack-plugin插件的追加配置 [] || (config,NODE_ENV)=>([])
    CopyWebpackOptions: function(conf, env) {
        //将node_modules/bpmn-js的静态资源分模式拷贝
        return [
            {
                from: path.resolve(__dirname, '../node_modules/bpmn-js/dist/assets'),
                to: (env === 'production' ? conf.build.assetsSubDirectory : conf.dev.assetsSubDirectory) + '/bpmn',
                test: /\.css$/,
            },
            {
                from: path.resolve(__dirname, '../node_modules/bpmn-js/dist/assets/bpmn-font/css'),
                to: (env === 'production' ? conf.build.assetsSubDirectory : conf.dev.assetsSubDirectory) + '/bpmn',
                test: /\.css$/,
            },
        ];
    },
    //html-webpack-tags-plugin插件的追加配置 [] || (config,NODE_ENV)=>([])
    HtmlIncludeAssets: [
        {
            //在index.html中添加 node_modules/bpmn-js的css静态资源
            tags: [
                {
                    path: 'static/bpmn',
                    glob: '*.css',
                    globPath: 'node_modules/bpmn-js/dist/assets',
                },
                {
                    path: 'static/bpmn',
                    glob: '*.css',
                    globPath: 'node_modules/bpmn-js/dist/assets/bpmn-font/css',
                },
            ], // 添加的资源相对html的路径
            append: false, // false 在其他资源的之前添加 true 在其他资源之后添加
        },
        //在index.html添加script标签
        {
            tags: [
                {
                    path: 'doc-service/jquery.min.js',
                },
                {
                    path: 'doc-service/pageoffice.js',
                    attributes: { id: 'po_js_main' },
                },
            ], // 添加的资源相对html的路径
            append: true, // false 在其他资源的之前添加 true 在其他资源之后添加
        },
    ],
    //开发模式配置
    dev: {
        // 不进行编译的静态文件目录
        assetsSubDirectory: 'static',
        // 前缀路径, npm run dev --basepath=/mypath/的basepath优先级大于此
        assetsPublicPath: '/',
        // devServer的反代理配置
        proxyTable: {},
        host: '0.0.0.0',
        port: 33000,
        //启动服务后是否自动打开浏览器,可以是浏览器文件如 'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'
        autoOpenBrowser: false,
        //出现编译器错误或警告时，在浏览器中显示全屏覆盖
        errorOverlay: true,
        //编译出错在右下角弹出提醒
        notifyOnErrors: true,
        poll: false,
        //是否编译时启用eslint
        useEslint: true,
        //追eslint-loader的rule
        eslintRule: {},
        devtool: 'cheap-module-eval-source-map',
        //css生成 SourceMap
        cssSourceMap: true,
    },
    //生产模式配置
    build: {
        // 根目录的index.html模板打包后的位置
        index: resolve('dist/index.html'),
        // 打包后所有文件的位置
        assetsRoot: resolve('dist'),
        // 不进行编译的静态文件目录
        assetsSubDirectory: 'static',
        // 前缀路径, npm run build --basepath=/mypath/的basepath优先级大于此
        assetsPublicPath: '/',
        // 是否生成 SourceMap
        productionSourceMap: false,
        // https://webpack.js.org/configuration/devtool/#production
        devtool: 'source-map',
        // 是否打包压缩zip
        productionGzip: false,
        productionGzipExtensions: ['js', 'css'],
        // 打包完成后打开报告, npm run build --report 触发
        bundleAnalyzerReport: process.env.npm_config_report,
    },
    //覆盖webpack配置
    webpackReplacement: {},
};
module.exports = config;
```

## dll 的使用(在项目的中后期提高构建效率)

对应 `zerod.config.js` 的 dll 配置

- `npm run dll`会把 dll.dllModules 模块按顺序依赖预打包生成 dllStatic， 
- 再`npm run dev`启动完成后会生成 dll.dllLibrarys 相关的 dllLibrarysManifes/\*-modules-manifes.json， 
- 再`npm run dll-lib`会把 dllLibrarysManifes/\*-modules-manifes.json 记录的模块生成 dllStatic/librarysDll。

## 模板 zerod-simple-webpack

主要依赖`react v16.8+`+`react-router v5`+`scss`+`axios`的简单模板，目录结构如下：

```js
├── /dist/ # 项目打包输出目录
├── /share-code/ # 此目录的作用，当前项目需要独立出一些模块共享给其他项目时发布到私服，此目录名称可以随意修改，但需在zerod.config.js中配置copyFolderName
│ └── package.json# 发布包的package.json
├── /src/  # 项目开发源码目录
│ ├── App.jsx # 根组件
│ ├── app.scss# 根样式文件
│ └── main.js # 项目入口文件
├── /static/  # 不会被压缩打包的静态文件放这里
├── .eslintrc.js # Eslin配置
├── .gitgnore # git忽略检测的配置
├── .postcssrc.js# postcss配置
├── .prettierrc.js# 统一格式化代码 prettier 的配置， vscode 编辑器需安装 prettier 插件
├── index.html# 单页面唯一的html
├── babel.config.js  # babel配置
├── package.json #
└── zerod.config.js  # 配置文件，可以配置反代理路径和打包公共路径等等
```

## 模板 zerod-admin-webpack

主要依赖`react v16.8+`+`react-router v5`+`antd v3.x`+`zerod v0.x`+`scss`+`axios`等的 PC 端单页面模板，目录结构如下：

```js
├── /dist/ # 项目打包输出目录
├── /share-code/ # 此目录的作用，当前项目需要独立出一些模块共享给其他项目时发布到私服，此目录名称可以随意修改，但需在zerod.config.js中配置copyFolderName
│ └── package.json# 发布包的package.json
├── /src/  # 项目开发源码目录
│ ├── /Api/# 后台接口文件夹,
│ ├── /assets/# 公共文件:图片，iconfont,
│ │ ├── /iconfont/# 来自 http://www.iconfont.cn/?spm=a313x.7781069.1998910419.d4d0a486a
│ │ └── /images/ # 图片
│ ├── /components/# 自生产的通用组件
│ │ └── load-components.js# 自动加载/components/下`index.jsx`文件(可选用)
│ │ ├── /AbgImage/# 组件文件夹，对应组件名称
│ │ │ ├── index.jsx  # 组件主要文件（必需的）
│ │ │ └── style.scss # 组件样式文件（如果需要）
│ ├── /context/  # react “动态上下文” 文件
│ ├── /lazyLoad/
│ │ └── lazyLoad.js  # 这样使用const componet=lazyLoad(()=>import('./componet.jsx'))实现异步组件
│ ├── /scss/  # 通用样式文件夹
│ │ └── index.scss#
│ ├── /store/ # 状态管理仓库，使用redux + react-redux，使用react hooks 后台可以选择不用react-redux
│ ├── /views/ # 路由组件目录，应当按照路由结构创建
│ ├── /zTool/ # 通用工具目录
│ │ └── httpAjax.js  # ajax库：默认zerod-ztool/axiosInterceptor/httpAjax 对 axios 的封装
│ ├── ant-icons.js# 按需引入ant-design的icon文件
│ ├── App.api.js # 自动加载/Api/下`.api.js`后缀的文件(可选用)
│ ├── App.context.js # 自动加载/context/下的'Context.js'(可选用)
│ ├── App.jsx # 根组件
│ ├── app.scss# 根样式文件
│ └── main.js # 项目入口文件
├── /static/  # 不会被压缩打包的静态文件放这里
├── .eslintrc.js # Eslin配置
├── .gitgnore # git忽略检测的配置
├── .postcssrc.js# postcss配置
├── .prettierrc.js# 统一格式化代码 prettier 的配置， vscode 编辑器需安装 prettier 插件
├── index.html# 单页面唯一的html
├── babel.config.js  # babel配置
├── package.json #
└── zerod.config.js  # 配置文件，可以配置反代理路径和打包公共路径等等
```

> `babel.config.js`中已经用`babel-plugin-import`配置了对`antd`和`zerod`的按需打包模块，当存在 dllStatic/librarysDll/style/antd.\*.css 时，会自动对`antd`按需的 style:true 改为 style:false。

## 模板 zerod-mobile-webpack

主要依赖`react v16.8+`+`react-router v5`+`antd-mobile v2.x`+`scss`+`axios`等的移动端单页面模板，目录结构如下：

```js
├── /dist/ # 项目打包输出目录
├── /share-code/ # 此目录的作用，当前项目需要独立出一些模块共享给其他项目时发布到私服，此目录名称可以随意修改，但需在zerod.config.js中配置copyFolderName
│ └── package.json# 发布包的package.json
├── /src/  # 项目开发源码目录
│ ├── /Api/# 后台接口文件夹,
│ ├── /assets/# 公共文件:图片，iconfont,
│ │ ├── /iconfont/# 来自 http://www.iconfont.cn/?spm=a313x.7781069.1998910419.d4d0a486a
│ │ └── /images/ # 图片
│ ├── /components/# 自生产的通用组件
│ │ └── load-components.js# 自动加载/components/下`index.jsx`文件(可选用)
│ │ ├── /AbgImage/# 组件文件夹，对应组件名称
│ │ │ ├── index.jsx  # 组件主要文件（必需的）
│ │ │ └── style.scss # 组件样式文件（如果需要）
│ ├── /context/  # react “动态上下文” 文件
│ ├── /lazyLoad/
│ │ └── lazyLoad.js  # 这样使用const componet=lazyLoad(()=>import('./componet.jsx'))实现异步组件
│ ├── /scss/  # 通用样式文件夹
│ │ └── index.scss#
│ ├── /store/ # 状态管理仓库，使用redux + react-redux，使用react hooks 后台可以选择不用react-redux
│ ├── /views/ # 路由组件目录，应当按照路由结构创建
│ ├── /zTool/ # 通用工具目录
│ │ └── httpAjax.js  # ajax库：默认zerod-ztool/axiosInterceptor/httpAjax 对 axios 的封装
│ ├── App.api.js # 自动加载/Api/下`.api.js`后缀的文件(可选用)
│ ├── App.context.js # 自动加载/context/下的'Context.js'(可选用)
│ ├── App.jsx # 根组件
│ ├── app.scss# 根样式文件
│ ├── theme-vars.scss # scss主题变量，用于覆盖antd-mobile的less主题变量
│ └── main.js # 项目入口文件
├── /static/  # 不会被压缩打包的静态文件放这里
├── .eslintrc.js # Eslin配置
├── .gitgnore # git忽略检测的配置
├── .postcssrc.js# postcss配置
├── .prettierrc.js# 统一格式化代码 prettier 的配置， vscode 编辑器需安装 prettier 插件
├── index.html# 单页面唯一的html
├── babel.config.js  # babel配置
├── package.json #
└── zerod.config.js  # 配置文件，可以配置反代理路径和打包公共路径等等
```

> 自适应原则：自动流布局为主，vw、vh 为辅，能不写固定宽度就不写。
> `.postcssrc.js`配置了[postcss-px-to-viewport(可以按实际需要修改参数)](https://github.com/evrone/postcss-px-to-viewport#usage)用于将 px 单位转 vh、vw，转换设计稿分辨率默认是 750x1334，所以可以尽情的按照设计稿的 px 单位。

## share-code

此目录的作用，当前项目需要独立出一些模块共享给其他项目时发布到私服(相当于发布npm包)，此目录名称可以随意修改，但需在zerod.config.js中配置copyFolderName

share-code/package.json中的name就是发布到私服的包名，为了更加直观，尽量将share-code这个目录名称与包名一致

## 模板 zerod-markdown-webpack

用 markdonw 写前端组件文档与 Demo 的编译模板

`.md`文件进入编译成文档的使用方式请查看<span class="z-history-href" data-path="/main/zerod-markdown">编写组件文档</span>

```js
├── /dist/ # 项目打包输出目录
├── /src/  # 组件开发源码与.md文件的目录
│ ├── ant-icons.js# 按需引入ant-design的icon文件
│ ├── docs.config.js # 可配置文档侧栏导航
│ └── package.json# 发布包的package.json
├── /static/  # 不会被压缩打包的静态文件放这里
├── .eslintrc.js # Eslin配置
├── .gitgnore # git忽略检测的配置
├── .postcssrc.js# postcss配置
├── .prettierrc.js# 统一格式化代码 prettier 的配置， vscode 编辑器需安装 prettier 插件
├── babel.config.js  # babel配置
├── package.json #
└── zerod.config.js  # 配置文件，可以配置反代理路径和打包公共路径等等
```
